# 基金实时估值获取工具

基于多个金融数据接口库获取中国各类基金的实时估值、净值和行情数据。

## 功能特性

### Web应用功能 ✅ 已实现
- ✅ 基金实时估值计算（基于重仓股涨跌幅加权）
- ✅ 基金搜索功能（支持代码、名称、拼音缩写）
- ✅ 重仓股详情展示（持仓比例、最新价、涨跌幅）
- ✅ 实时时间显示
- ✅ 下一交易日显示
- ✅ 交易时间判断
- ✅ 多数据源股票行情接口（A股、港股、北交所）
- ✅ 反爬虫策略（User-Agent轮换、随机延迟、连接池、IP代理池）
- ✅ 基金名称缓存机制

### 方式一：直接获取基金实时估值 🚧 规划中
- 🔄 基金实时净值估算（估值）
- 🔄 ETF基金实时行情
- 🔄 LOF基金实时行情
- 🔄 开放式基金最新净值
- 🔄 基金业绩排行
- 🔄 涨幅排名筛选
- 🔄 数据导出为CSV

### 方式二：基于重仓股计算实时估值 ✅ 已实现
- ✅ 获取基金重仓股持仓信息
- ✅ 获取重仓股实时行情
- ✅ 根据重仓股涨跌幅推算基金净值
- ✅ 加权平均计算方法
- ✅ 详细的计算结果展示和导出

## 安装依赖

```bash
pip install -r requirements.txt
```

## 金融库说明

本项目使用以下金融数据接口库：

### 1. AkShare
- **版本要求**: >= 1.18.0
- **主要用途**:
  - 获取基金基本信息和净值数据
  - 获取基金重仓股持仓信息
  - 获取基金业绩排行数据
  - 获取ETF/LOF基金实时行情
- **数据来源**: 东方财富网、同花顺、天天基金网

### 2. EFinance
- **版本要求**: >= 0.5.5
- **主要用途**:
  - 获取A股实时行情数据
  - 获取港股实时行情数据
  - 获取北交所股票实时行情数据
  - 获取基金名称和基本信息
  - 获取基金最新净值数据
- **优势**: 响应速度快，数据更新及时
- **数据来源**: 东方财富网

### 3. 自研接口
- **主要用途**:
  - 统一的股票行情接口（支持A股、港股、北交所）
  - 多数据源自动切换（腾讯、新浪、网易、雪球）
  - 反爬虫策略（User-Agent轮换、随机延迟、连接池、IP代理池）
- **优势**: 稳定性高，支持多市场，防封禁能力强

### 4. 其他依赖库
- **Pandas** (>= 1.5.0): 数据处理和分析
- **OpenPyXL** (>= 3.0.0): Excel文件读写
- **Flask** (>= 3.0.0): Web应用框架

### 数据源优先级
系统按以下优先级选择数据源：
1. **EFinance** - 首选，速度快且稳定
2. **自研接口** - 备用，支持多数据源切换
3. **AkShare** - 补充，用于特定数据获取

## 使用方法

### 1. 基础使用

```python
from fund_realtime_value import FundRealtimeValue

# 创建实例
fund = FundRealtimeValue()

# 获取全部基金实时估值
estimation = fund.get_fund_estimation(fund_type="全部")
print(estimation.head(10))

# 获取特定类型基金（如股票型）
stock_fund = fund.get_fund_estimation(fund_type="股票型")
```

### 2. ETF实时行情

```python
# 获取ETF实时行情
etf = fund.get_etf_spot()
print(etf.head(10))
```

### 3. LOF实时行情

```python
# 获取LOF实时行情
lof = fund.get_lof_spot()
print(lof.head(10))
```

### 4. 筛选涨幅基金

```python
# 先获取估值数据
fund.get_fund_estimation(fund_type="全部")

# 获取涨幅前20的基金
top_20 = fund.filter_top_growth(top_n=20)
print(top_20)
```

### 5. 搜索基金

```python
# 搜索特定基金
result = fund.search_fund("易方达")
print(result)
```

### 6. 保存数据

```python
# 保存为CSV
fund.save_to_csv(filename="my_funds.csv")

# 或使用时间戳自动命名
fund.save_to_csv()
```

## 方式二：基于重仓股计算基金实时估值 ⭐ 新增

当基金实时估值数据不可用时，可以通过基金重仓股的实时表现来推算基金净值。

### 计算原理

1. **获取基金重仓股持仓**：获取基金最新的季度持仓报告（前十大重仓股）
2. **获取重仓股实时行情**：获取这些股票的实时价格和涨跌幅
3. **加权计算估值**：根据各重仓股的持仓比例和涨跌幅，加权计算基金的估算净值

### 自动检测最新季度 ⭐

系统会自动根据当前日期判断最新的可用季度，并从返回的数据中筛选出对应季度的持仓数据：

- **1-3月**：使用去年Q4季报（次年1月公布）
- **4-6月**：使用当年Q1季报（4月公布）
- **7-9月**：使用当年Q2季报（7月公布）
- **10-12月**：使用当年Q3季报（10月公布）

例如：
- 当前是2026年1月 → 系统会获取2025年数据，并自动筛选"2025年第4季度"
- 当前是2026年5月 → 系统会获取2026年数据，并自动筛选"2026年第1季度"

### 季度数据筛选 ⭐

AkShare返回的数据可能包含多个季度的持仓信息，系统会自动：
1. 根据当前日期确定目标季度（如"2025年第4季度"）
2. 从返回的数据中筛选出目标季度
3. 如果目标季度不存在，自动使用最新的可用季度

示例：
```
返回数据包含：
- 2025年第1季度
- 2025年第2季度
- 2025年第3季度
- 2025年第4季度

系统会根据当前时间自动筛选出"2025年第4季度"的数据
```

### 使用方法

```python
from fund_realtime_calc import FundRealtimeCalculator

# 创建计算器实例
calculator = FundRealtimeCalculator()

# 1. 获取基金重仓股持仓（自动检测最新季度）
portfolio = calculator.get_fund_portfolio(fund_code="110011")

# 或手动指定年份（不推荐）
# portfolio = calculator.get_fund_portfolio(fund_code="110011", year="2024")

# 2. 获取重仓股实时行情
quotes = calculator.get_stock_realtime_quotes()

# 3. 获取基金最新净值（可选，用于计算涨跌）
last_nav = calculator.get_fund_latest_nav(fund_code="110011")

# 4. 计算实时估值
result = calculator.calculate_realtime_value(method='weighted')

# 5. 显示结果
calculator.print_result()

# 6. 保存结果
calculator.save_result()
```

### 运行交互式程序

```bash
python fund_realtime_calc.py
```

### 计算方法

| 方法 | 说明 | 适用场景 |
|------|------|----------|
| weighted | 加权平均法 | 根据持仓比例加权，更准确 |
| simple | 简单平均法 | 不考虑持仓比例，快速估算 |

### 输出结果示例

```
============================================================
基金实时估值计算结果
============================================================
基金代码: 110011
基金名称: 易方达消费行业股票
计算时间: 2024-01-31 14:30:15

净值信息:
  最新净值: 2.1234
  估算净值: 2.1356
  估算涨跌: +0.57%

重仓股表现:
------------------------------------------------------------
股票代码   股票名称      持销比例      最新价       涨跌幅
------------------------------------------------------------
000858    五粮液      8.50%       165.23     +1.25%
600519    贵州茅台     7.80%       1789.00    +0.85%
000568    泸州老窖     6.20%       198.50     +0.68%
...
============================================================
```

### 注意事项

1. **数据延迟**：重仓股持仓数据基于季报，有3-6个月的滞后性
2. **估算误差**：仅考虑前十大重仓股，未包含债券、现金等其他资产
3. **交易时间**：实时行情仅在交易时间内有效
4. **准确性**：估值仅供参考，实际净值以官方公布为准

## 运行主程序

```bash
python fund_realtime_value.py
```

主程序会交互式地：
1. 获取基金实时估值
2. 显示涨幅前20的基金
3. 演示基金搜索功能
4. 获取ETF和LOF实时行情
5. 提供数据保存选项

## 支持的基金类型

- 全部
- 股票型
- 混合型
- 债券型
- 货币型
- 指数型
- QDII
- FOF
- 等等

## 数据字段说明

### 基金实时估值数据
- 基金代码
- 基金名称
- 实时估值
- 估算增长率
- 实际净值
- 净值日期

### ETF/LOF实时行情
- 代码
- 名称
- 最新价
- 涨跌幅
- 成交量
- 成交额
- 等等

## 注意事项

### 通用注意事项
1. **数据更新时间**：
   - 实时估值：交易时间内持续更新
   - 基金净值：交易日16:00-23:00更新

2. **网络要求**：需要稳定的网络连接

3. **访问频率**：避免过于频繁的数据请求

4. **节假日**：非交易日可能无实时数据

### 重仓股计算估值注意事项
1. **持仓数据延迟**：基金重仓股持仓数据基于季报，存在3-6个月的滞后性，可能不代表当前实际持仓
2. **估算范围**：仅考虑前十大重仓股，未包含其他持仓资产（如债券、现金、其他股票等）
3. **估值精度**：计算结果为估算值，仅供参考，实际净值以基金公司官方公布为准
4. **市场波动**：市场剧烈波动时，估算误差可能较大
5. **持仓变化**：基金经理可能根据市场情况调整持仓，重仓股比例可能已发生变化

## 未实现功能 🚧

以下功能正在规划或开发中：

### 净值跟踪
- 🔄 **ETF净值跟踪**：实时跟踪ETF基金的净值变化，对比市价与净值的折溢价情况
- 🔄 **LOF净值跟踪**：实时跟踪LOF基金的净值变化，提供套利机会分析

### 市场分析
- 🔄 **买入榜**：显示市场热门买入基金，分析资金流向
- 🔄 **卖出榜**：显示市场热门卖出基金，识别资金流出趋势

### 用户功能
- 🔄 **基金自选**：用户可以添加自选基金，方便快速查看关注的基金
- 🔄 **定时刷新**：自动定时刷新基金数据，无需手动操作
- 🔄 **浏览器缓存**：利用浏览器本地缓存，提升页面加载速度，减少服务器请求
- 🔄 **账号设置**：用户账号管理，包括个人信息设置、偏好配置等
- 🔄 **权限功能**：不同用户角色拥有不同的功能权限，如普通用户、管理员等

### 高级功能
- 🔄 **基金对比分析**：多只基金的业绩对比和风险评估
- 🔄 **历史净值查询**：查询基金历史净值走势
- 🔄 **分红记录查询**：查询基金分红历史记录
- 🔄 **基金经理信息**：展示基金经理的资历和历史业绩

## API 接口来源

本工具使用的数据接口来自多个金融数据源：

### 主要数据源
- **东方财富网**: 基金净值、重仓股持仓、实时行情
- **腾讯财经**: A股、港股实时行情
- **新浪财经**: A股、港股实时行情
- **网易财经**: A股实时行情
- **雪球**: A股实时行情

### 数据接口库
- [AkShare](https://akshare.akfamily.xyz): 综合金融数据接口库
- [EFinance](https://efinance.pydata.org): 东方财富网数据接口

## 许可证

MIT License
